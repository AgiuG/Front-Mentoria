trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '14.x'
  displayName: 'Install Node.js'

- script: |
    npm install
    npm run build
  displayName: 'npm install and build'

# - task: CopyFiles@2
#   inputs:
#     Contents: ''
#     TargetFolder: '$(build.artifactstagingdirectory)'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'build'
    ArtifactName: 'front'
    publishLocation: 'Container'

jobs:
      - job: NPM
        displayName: Yarn Install & Yarn Test
        steps:
          - task: SonarQubePrepare@4
            displayName: Prepare Analysis Configuration
            inputs:
              SonarQube: $(sonar_qube_service_connection)
              scannerMode: 'CLI'
              configMode: 'file'
          - script: yarn install
            displayName: YARN Install
          - script: yarn pipeline-linux-coverage
            displayName: YARN cypress
